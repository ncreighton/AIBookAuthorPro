<Window x:Class="AIBookAuthorPro.UI.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:viewModels="clr-namespace:AIBookAuthorPro.UI.ViewModels"
        mc:Ignorable="d"
        Title="{Binding Title}"
        Height="800" Width="1400"
        MinHeight="600" MinWidth="1000"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource MaterialDesignPaper}"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        TextElement.FontWeight="Regular"
        TextElement.FontSize="14"
        FontFamily="{materialDesign:MaterialDesignFont}"
        d:DataContext="{d:DesignInstance viewModels:MainViewModel}">

    <Window.InputBindings>
        <KeyBinding Key="N" Modifiers="Control" Command="{Binding NewProjectCommand}" />
        <KeyBinding Key="O" Modifiers="Control" Command="{Binding OpenProjectCommand}" />
        <KeyBinding Key="S" Modifiers="Control" Command="{Binding SaveProjectCommand}" />
        <KeyBinding Key="S" Modifiers="Control+Shift" Command="{Binding SaveProjectAsCommand}" />
    </Window.InputBindings>

    <materialDesign:DialogHost Identifier="RootDialog">
        <DockPanel>
            <!-- Menu Bar -->
            <Menu DockPanel.Dock="Top" 
                  Background="{DynamicResource MaterialDesignToolBarBackground}"
                  Foreground="{DynamicResource MaterialDesignBody}">
                <MenuItem Header="_File">
                    <MenuItem Header="_New Project" Command="{Binding NewProjectCommand}"
                              Icon="{materialDesign:PackIcon Kind=FileDocumentPlusOutline}"
                              InputGestureText="Ctrl+N" />
                    <MenuItem Header="_Open Project..." Command="{Binding OpenProjectCommand}"
                              Icon="{materialDesign:PackIcon Kind=FolderOpenOutline}"
                              InputGestureText="Ctrl+O" />
                    <Separator />
                    <MenuItem Header="_Recent Projects" ItemsSource="{Binding RecentProjects}">
                        <MenuItem.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Title}" />
                            </DataTemplate>
                        </MenuItem.ItemTemplate>
                        <MenuItem.ItemContainerStyle>
                            <Style TargetType="MenuItem" BasedOn="{StaticResource MaterialDesignMenuItem}">
                                <Setter Property="Command" Value="{Binding DataContext.OpenProjectCommand, RelativeSource={RelativeSource AncestorType=Window}}" />
                                <Setter Property="CommandParameter" Value="{Binding FilePath}" />
                            </Style>
                        </MenuItem.ItemContainerStyle>
                    </MenuItem>
                    <Separator />
                    <MenuItem Header="_Save" Command="{Binding SaveProjectCommand}"
                              Icon="{materialDesign:PackIcon Kind=ContentSave}"
                              InputGestureText="Ctrl+S" />
                    <MenuItem Header="Save _As..." Command="{Binding SaveProjectAsCommand}"
                              Icon="{materialDesign:PackIcon Kind=ContentSaveAll}"
                              InputGestureText="Ctrl+Shift+S" />
                    <Separator />
                    <MenuItem Header="_Export">
                        <MenuItem Header="Export as DOCX..." Icon="{materialDesign:PackIcon Kind=FileWordBox}" />
                        <MenuItem Header="Export as PDF..." Icon="{materialDesign:PackIcon Kind=FilePdfBox}" />
                        <MenuItem Header="Export as EPUB..." Icon="{materialDesign:PackIcon Kind=BookOpenVariant}" />
                    </MenuItem>
                    <Separator />
                    <MenuItem Header="E_xit" InputGestureText="Alt+F4" />
                </MenuItem>
                <MenuItem Header="_Edit">
                    <MenuItem Header="_Undo" InputGestureText="Ctrl+Z" Icon="{materialDesign:PackIcon Kind=Undo}" />
                    <MenuItem Header="_Redo" InputGestureText="Ctrl+Y" Icon="{materialDesign:PackIcon Kind=Redo}" />
                    <Separator />
                    <MenuItem Header="Cu_t" InputGestureText="Ctrl+X" Icon="{materialDesign:PackIcon Kind=ContentCut}" />
                    <MenuItem Header="_Copy" InputGestureText="Ctrl+C" Icon="{materialDesign:PackIcon Kind=ContentCopy}" />
                    <MenuItem Header="_Paste" InputGestureText="Ctrl+V" Icon="{materialDesign:PackIcon Kind=ContentPaste}" />
                    <Separator />
                    <MenuItem Header="Find &amp; Replace..." InputGestureText="Ctrl+H" Icon="{materialDesign:PackIcon Kind=FindReplace}" />
                </MenuItem>
                <MenuItem Header="_View">
                    <MenuItem Header="Editor" Command="{Binding NavigateToCommand}" CommandParameter="Editor" />
                    <MenuItem Header="Outline" Command="{Binding NavigateToCommand}" CommandParameter="Outline" />
                    <MenuItem Header="Characters" Command="{Binding NavigateToCommand}" CommandParameter="Characters" />
                    <MenuItem Header="Locations" Command="{Binding NavigateToCommand}" CommandParameter="Locations" />
                    <MenuItem Header="Research" Command="{Binding NavigateToCommand}" CommandParameter="Research" />
                </MenuItem>
                <MenuItem Header="_AI">
                    <MenuItem Header="Generate Chapter..." Icon="{materialDesign:PackIcon Kind=Robot}" />
                    <MenuItem Header="Expand Selection..." Icon="{materialDesign:PackIcon Kind=TextBoxPlusOutline}" />
                    <MenuItem Header="Rewrite Selection..." Icon="{materialDesign:PackIcon Kind=Pencil}" />
                    <Separator />
                    <MenuItem Header="Generate Outline..." Icon="{materialDesign:PackIcon Kind=FormatListBulleted}" />
                    <MenuItem Header="Create Character..." Icon="{materialDesign:PackIcon Kind=AccountPlus}" />
                    <Separator />
                    <MenuItem Header="AI Settings..." Icon="{materialDesign:PackIcon Kind=Cog}" />
                </MenuItem>
                <MenuItem Header="_Tools">
                    <MenuItem Header="Word Count Statistics" Icon="{materialDesign:PackIcon Kind=Counter}" />
                    <MenuItem Header="Spell Check" Icon="{materialDesign:PackIcon Kind=Spellcheck}" />
                    <MenuItem Header="Grammar Check" Icon="{materialDesign:PackIcon Kind=CheckDecagram}" />
                </MenuItem>
                <MenuItem Header="_Help">
                    <MenuItem Header="Documentation" Icon="{materialDesign:PackIcon Kind=HelpCircle}" />
                    <MenuItem Header="About AI Book Author Pro" Icon="{materialDesign:PackIcon Kind=Information}" />
                </MenuItem>
            </Menu>

            <!-- Toolbar -->
            <ToolBarTray DockPanel.Dock="Top" Background="{DynamicResource MaterialDesignToolBarBackground}">
                <ToolBar ClipToBounds="False">
                    <Button Command="{Binding NewProjectCommand}" ToolTip="New Project (Ctrl+N)">
                        <materialDesign:PackIcon Kind="FileDocumentPlusOutline" />
                    </Button>
                    <Button Command="{Binding OpenProjectCommand}" ToolTip="Open Project (Ctrl+O)">
                        <materialDesign:PackIcon Kind="FolderOpenOutline" />
                    </Button>
                    <Button Command="{Binding SaveProjectCommand}" ToolTip="Save (Ctrl+S)">
                        <materialDesign:PackIcon Kind="ContentSave" />
                    </Button>
                    <Separator />
                    <Button ToolTip="Undo (Ctrl+Z)">
                        <materialDesign:PackIcon Kind="Undo" />
                    </Button>
                    <Button ToolTip="Redo (Ctrl+Y)">
                        <materialDesign:PackIcon Kind="Redo" />
                    </Button>
                    <Separator />
                    <Button ToolTip="Generate with AI" Style="{StaticResource MaterialDesignFlatAccentButton}">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Robot" />
                            <TextBlock Text="Generate" Margin="4,0,0,0" />
                        </StackPanel>
                    </Button>
                </ToolBar>
            </ToolBarTray>

            <!-- Status Bar -->
            <StatusBar DockPanel.Dock="Bottom" Background="{DynamicResource MaterialDesignToolBarBackground}">
                <StatusBarItem>
                    <TextBlock Text="{Binding StatusMessage}" />
                </StatusBarItem>
                <Separator />
                <StatusBarItem>
                    <StackPanel Orientation="Horizontal" Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                                     Value="0" IsIndeterminate="True"
                                     Width="16" Height="16" />
                    </StackPanel>
                </StatusBarItem>
                <StatusBarItem HorizontalAlignment="Right">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Words: " />
                        <TextBlock Text="{Binding CurrentProject.Metadata.WordCount, FallbackValue=0}" />
                    </StackPanel>
                </StatusBarItem>
            </StatusBar>

            <!-- Main Content Area -->
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="280" MinWidth="200" MaxWidth="400" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!-- Left Sidebar - Navigation & Chapters -->
                <Border Grid.Column="0" 
                        Background="{DynamicResource MaterialDesignCardBackground}"
                        BorderBrush="{DynamicResource MaterialDesignDivider}"
                        BorderThickness="0,0,1,0">
                    <DockPanel>
                        <!-- Navigation Tabs -->
                        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" 
                                    Margin="8" HorizontalAlignment="Center">
                            <RadioButton Style="{StaticResource MaterialDesignTabRadioButtonTop}"
                                         Content="Editor" IsChecked="True"
                                         Command="{Binding NavigateToCommand}" CommandParameter="Editor" />
                            <RadioButton Style="{StaticResource MaterialDesignTabRadioButtonTop}"
                                         Content="Outline"
                                         Command="{Binding NavigateToCommand}" CommandParameter="Outline" />
                            <RadioButton Style="{StaticResource MaterialDesignTabRadioButtonTop}"
                                         Content="World"
                                         Command="{Binding NavigateToCommand}" CommandParameter="World" />
                        </StackPanel>

                        <!-- Chapter List Header -->
                        <DockPanel DockPanel.Dock="Top" Margin="8,0,8,8">
                            <TextBlock Text="Chapters" 
                                       Style="{StaticResource MaterialDesignSubtitle1TextBlock}"
                                       VerticalAlignment="Center" />
                            <Button DockPanel.Dock="Right" 
                                    Style="{StaticResource MaterialDesignIconButton}"
                                    Command="{Binding AddChapterCommand}"
                                    ToolTip="Add Chapter"
                                    HorizontalAlignment="Right">
                                <materialDesign:PackIcon Kind="Plus" />
                            </Button>
                        </DockPanel>

                        <!-- Chapter List -->
                        <ListBox ItemsSource="{Binding Chapters}"
                                 SelectedItem="{Binding SelectedChapter}"
                                 Style="{StaticResource MaterialDesignNavigationPrimaryListBox}"
                                 Margin="0,0,0,8">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <DockPanel>
                                        <materialDesign:PackIcon Kind="FileDocument" 
                                                                 Margin="0,0,8,0"
                                                                 VerticalAlignment="Center" />
                                        <StackPanel>
                                            <TextBlock Text="{Binding Title}" 
                                                       FontWeight="Medium" />
                                            <TextBlock>
                                                <TextBlock.Text>
                                                    <MultiBinding StringFormat="{}{0} words">
                                                        <Binding Path="WordCount" />
                                                    </MultiBinding>
                                                </TextBlock.Text>
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="Foreground" Value="{DynamicResource MaterialDesignBodyLight}" />
                                                        <Setter Property="FontSize" Value="11" />
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                        </StackPanel>
                                    </DockPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </DockPanel>
                </Border>

                <!-- Splitter -->
                <GridSplitter Grid.Column="1" Width="4" 
                              HorizontalAlignment="Center" VerticalAlignment="Stretch"
                              Background="Transparent" />

                <!-- Main Editor Area -->
                <Border Grid.Column="2" Background="{DynamicResource MaterialDesignPaper}">
                    <Grid>
                        <!-- Welcome Screen (No Project) -->
                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center"
                                    Visibility="{Binding IsProjectOpen, Converter={StaticResource InverseBoolToVisConverter}}">
                            <materialDesign:PackIcon Kind="BookOpenPageVariant" 
                                                     Width="96" Height="96"
                                                     HorizontalAlignment="Center"
                                                     Foreground="{DynamicResource MaterialDesignBodyLight}" />
                            <TextBlock Text="AI Book Author Pro" 
                                       Style="{StaticResource MaterialDesignHeadline4TextBlock}"
                                       HorizontalAlignment="Center" Margin="0,16,0,8" />
                            <TextBlock Text="Create your next bestseller with AI assistance"
                                       Style="{StaticResource MaterialDesignBody1TextBlock}"
                                       HorizontalAlignment="Center"
                                       Foreground="{DynamicResource MaterialDesignBodyLight}" />
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,32,0,0">
                                <Button Style="{StaticResource MaterialDesignRaisedButton}"
                                        Command="{Binding NewProjectCommand}"
                                        Margin="8">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Plus" />
                                        <TextBlock Text="New Project" Margin="8,0,0,0" />
                                    </StackPanel>
                                </Button>
                                <Button Style="{StaticResource MaterialDesignOutlinedButton}"
                                        Command="{Binding OpenProjectCommand}"
                                        Margin="8">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="FolderOpen" />
                                        <TextBlock Text="Open Project" Margin="8,0,0,0" />
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                        </StackPanel>

                        <!-- Editor Content (Project Open) -->
                        <Grid Visibility="{Binding IsProjectOpen, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>

                            <!-- Chapter Header -->
                            <Border Grid.Row="0" 
                                    Background="{DynamicResource MaterialDesignCardBackground}"
                                    Padding="16,12">
                                <DockPanel>
                                    <StackPanel DockPanel.Dock="Right" Orientation="Horizontal">
                                        <Button Style="{StaticResource MaterialDesignFlatButton}"
                                                ToolTip="Generate Chapter with AI">
                                            <StackPanel Orientation="Horizontal">
                                                <materialDesign:PackIcon Kind="Robot" />
                                                <TextBlock Text="Generate" Margin="4,0,0,0" />
                                            </StackPanel>
                                        </Button>
                                    </StackPanel>
                                    <StackPanel>
                                        <TextBlock Text="{Binding SelectedChapter.Title, FallbackValue='No Chapter Selected'}"
                                                   Style="{StaticResource MaterialDesignHeadline6TextBlock}" />
                                        <TextBlock Foreground="{DynamicResource MaterialDesignBodyLight}">
                                            <TextBlock.Text>
                                                <MultiBinding StringFormat="{}{0} words | Last modified: {1:g}">
                                                    <Binding Path="SelectedChapter.WordCount" FallbackValue="0" />
                                                    <Binding Path="SelectedChapter.ModifiedAt" FallbackValue="Never" />
                                                </MultiBinding>
                                            </TextBlock.Text>
                                        </TextBlock>
                                    </StackPanel>
                                </DockPanel>
                            </Border>

                            <!-- Text Editor -->
                            <RichTextBox Grid.Row="1" 
                                         Margin="16"
                                         AcceptsTab="True"
                                         SpellCheck.IsEnabled="True"
                                         VerticalScrollBarVisibility="Auto"
                                         Background="{DynamicResource MaterialDesignPaper}"
                                         BorderThickness="0"
                                         FontFamily="Georgia"
                                         FontSize="16"
                                         Padding="48,32"
                                         materialDesign:TextFieldAssist.UnderlineBrush="Transparent">
                                <RichTextBox.Document>
                                    <FlowDocument PagePadding="48,32" LineHeight="28">
                                        <Paragraph>
                                            <Run Text="Start writing your chapter here..."
                                                 Foreground="{DynamicResource MaterialDesignBodyLight}" />
                                        </Paragraph>
                                    </FlowDocument>
                                </RichTextBox.Document>
                            </RichTextBox>
                        </Grid>
                    </Grid>
                </Border>
            </Grid>
        </DockPanel>
    </materialDesign:DialogHost>
</Window>